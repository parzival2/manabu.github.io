<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cross-compiler using crosstool-ng for Beaglebone | blog</title><meta name=keywords content="beaglebone,crosstool-ng"><meta name=description content="Cross-compiler using crosstool-ng for Beaglebone"><meta name=author content="Kalyan"><link rel=canonical href=https://parzival2.github.io/blog/posts/crosstool-ng-beaglebone/><meta name=google-site-verification content="XYZabc"><link href=/blog/assets/css/stylesheet.min.1eef9c740af75b4e5f773d9d5f757e03e3df71f3a308e73070cc73d55a59a7d7.css integrity="sha256-Hu+cdAr3W05fdz2dX3V+A+PfcfOjCOcwcMxz1VpZp9c=" rel="preload stylesheet" as=style><link rel=icon href=https://parzival2.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://parzival2.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://parzival2.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://parzival2.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://parzival2.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-123-45','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Cross-compiler using crosstool-ng for Beaglebone"><meta property="og:description" content="Cross-compiler using crosstool-ng for Beaglebone"><meta property="og:type" content="article"><meta property="og:url" content="https://parzival2.github.io/blog/posts/crosstool-ng-beaglebone/"><meta property="og:image" content="https://parzival2.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:published_time" content="2021-04-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-27T00:00:00+00:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://parzival2.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Cross-compiler using crosstool-ng for Beaglebone"><meta name=twitter:description content="Cross-compiler using crosstool-ng for Beaglebone"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://parzival2.github.io/blog/posts/"},{"@type":"ListItem","position":3,"name":"Cross-compiler using crosstool-ng for Beaglebone","item":"https://parzival2.github.io/blog/posts/crosstool-ng-beaglebone/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cross-compiler using crosstool-ng for Beaglebone","name":"Cross-compiler using crosstool-ng for Beaglebone","description":"Cross-compiler using crosstool-ng for Beaglebone In the previous post, I have used an already available cross-compiling compiler to cross-compile a C++ project for Beaglebone. I …","keywords":["beaglebone","crosstool-ng"],"articleBody":"Cross-compiler using crosstool-ng for Beaglebone In the previous post, I have used an already available cross-compiling compiler to cross-compile a C++ project for Beaglebone. I want to learn how I can do that so that I can utilize the learned knowledge if the need arises. I came to know that we can build a compiler using a tool called crosstool-ng. I am going to use it to build a compiler that can be used to cross-compile C and C++ applications for Beaglebone.\nBuilding crosstool-ng The crosstool-ng has to be built as an application before it can be used to build the compiler. When built, it will produce an executable ct-ng that can be used to build the final compiler.\ngit clone https://github.com/crosstool-ng/crosstool-ng cd crosstool-ng ./bootstrap ./configure --enable-local make After running the above commands, you will see that they have produced an executable ct-ng.\nGenerate the configuration for ARM cortex A8 processor using ct-ng\n./ct-ng arm-cortex_a8-linux-gnueabi Run menuconfig to edit the configurations\n./ct-ng menuconfig Make changes in Paths and misc options as shown below\n and also make changes in Target options to enable hard-floating point calculation capability.\n Exit and build the compiler using\n./ct-ng build It will take ~20minutes and if you have followed everything correctly then the build should succeed and you will have a folder in ~/x-tools and the compiler will be in ~/x-tools/arm-cortex_a8-linux-gnueabihf/bin\nAs you can see you didn’t change any configurations related to the compiler version and the Linux version on Beaglebone. The compiler you generated will not work if it depends on the libraries that are on Beaglebone and you would like to use mount the file-system using sshfs for sysroot as mentioned in the previous post.\nBeaglebone side Before we can build the compiler on the host-pc, we need to gather some data on the Beaglebone side. It is important that the GCC compiler that we are trying to build and the one that we have on the Beaglebone match. The GCC compiler on the Beaglebone can be found by using the command:\ndebian@beaglebone:~$ gcc -v Using built-in specs. COLLECT_GCC=gcc COLLECT_LTO_WRAPPER=/usr/lib/gcc/arm-linux-gnueabihf/8/lto-wrapper Target: arm-linux-gnueabihf Configured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=arm-linux-gnueabihf- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-libitm --disable-libquadmath --disable-libquadmath-support --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-sjlj-exceptions --with-arch=armv7-a --with-fpu=vfpv3-d16 --with-float=hard --with-mode=thumb --disable-werror --enable-checking=release --build=arm-linux-gnueabihf --host=arm-linux-gnueabihf --target=arm-linux-gnueabihf Thread model: posix gcc version 8.3.0 (Debian 8.3.0-6) Mine turned out to be 8.3.0\nNext we need to find the GLIBC version\ndebian@beaglebone:~$ ldd --version ldd (Debian GLIBC 2.28-10) 2.28 Then binutils version\ndebian@beaglebone:~$ ld --version GNU ld (GNU Binutils for Debian) 2.31.1 Copyright (C) 2018 Free Software Foundation, Inc. We also need the current Linux version that our Beaglebone have\nuname -a Linux beaglebone 4.19.94-ti-rt-r60 #1buster SMP PREEMPT RT Wed Mar 17 16:22:33 UTC 2021 armv7l GNU/Linux If you see the command where we determined gcc -v you will notice that --enable-multiarch has been enabled. This makes it to have another folder named arm-linux-gnueabihf in the /usr/include and /usr/lib folders as seen below\n/usr/lib/ ├── apt │ ├── methods │ ├── planners │ └── solvers ├── arm-linux-gnueabihf │ ├── audit │ ├── coreutils The cross-compiler that we are building needs to know that it has to look for some includes and libraries in that folder. This can be solved by applying a patch in binutils while building it using crosstool-ng.\nInstall the source for binutils on Beaglebone\nsudo apt install binutils-source Patching binutils Applying a patch for binutils is as simple as copying the patch from Beaglebone over to the host-pc.\nAs you have already installed the binutils-source the patches are also installed. The source can be found in /usr/src/binutils on Beaglebone. In patches folder, copy and paste the 129_multiarch_libpath.patch in /crosstool-ng/packages/binutils/2.31.1/. Please replace the 2.31.1 with the version that you determined by running ld --version in one of the previous step.\nBack to host-pc and finishing compilation Now we are back to the host-pc for finishing up the compilation. We need to configure all the versions of the tools according to the versions that we determined in Beaglebone so as to avoid linker errors.\nRun ./ct-ng menuconfig to bring up the configuration window.\nIn Operating System change the version of Linux that closely corresponds to the Linux version of Beaglebone. I am going with 4.18.20\n Next in Binary utilities section, change the version of binutils that is going to be used for the build. This has to correspond with the version that was determined earlier in Beaglebone.\n Moving on to C-library, change the glibc version to match with the version from Beaglebone.\n Now in C compiler, change the version of gcc to closely correspond to the version that is found in Beaglebone and also in gcc extra config add --enable-multiarch option as shown below.\n Run\nexport DEB_TARGET_MULTIARCH=arm-linux-gnueabihf Now build the toolchain again using ./ct-ng build.\nIf you run\n./arm-cortex_a8-linux-gnueabihf-ld -verbose | grep -i \"SEARCH\" from the compiler installation folder in ~/x-tools you will see that it also searches for arm-linux-gnueabihf folder.\nSEARCH_DIR(\"=/usr/local/lib/arm-linux-gnueabihf\"); SEARCH_DIR(\"=/lib/arm-linux-gnueabihf\"); SEARCH_DIR(\"=/usr/lib/arm-linux-gnueabihf\"); SEARCH_DIR(\"=/usr/local/lib\"); SEARCH_DIR(\"=/lib\"); SEARCH_DIR(\"=/usr/lib\"); SEARCH_DIR(\"=/home/kalyan/x-tools/arm-cortex_a8-linux-gnueabihf/arm-cortex_a8-linux-gnueabihf/lib\"); You can use the generated compiler using this toolchain file.\n# Set the system name set(CMAKE_SYSTEM_NAME Linux)# C Compiler set(COMPILER_PATH /home/kalyan/x-tools/arm-cortex_a8-linux-gnueabihf/bin)set(COMPILER_FRONT arm-cortex_a8-linux-gnueabihf-)set(CMAKE_TRY_COMPILE_TARGET_TYPE STATIC_LIBRARY)set(CMAKE_C_COMPILER ${COMPILER_PATH}/${COMPILER_FRONT}gcc)set(CMAKE_CXX_COMPILER ${COMPILER_PATH}/${COMPILER_FRONT}g++)# Sysroot location # It is mounted using sshfs set(CMAKE_SYSROOT /home/kalyan/Beaglebone-Sysroot)# These lines are necessary to let cmake know to only look in the # beaglebone for the libraries instead of looking in host pc. # sshfs debian@192.168.7.2:/ /home/kalyan/Beaglegone-Sysroot/ -o transform_symlinks set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)","wordCount":"912","inLanguage":"en","datePublished":"2021-04-27T00:00:00Z","dateModified":"2021-04-27T00:00:00Z","author":{"@type":"Person","name":"Kalyan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://parzival2.github.io/blog/posts/crosstool-ng-beaglebone/"},"publisher":{"@type":"Organization","name":"blog","logo":{"@type":"ImageObject","url":"https://parzival2.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://parzival2.github.io/blog accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://parzival2.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://parzival2.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://parzival2.github.io/blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Cross-compiler using crosstool-ng for Beaglebone</h1><div class=post-description>Cross-compiler using crosstool-ng for Beaglebone</div><div class=post-meta>April 27, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Kalyan</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#cross-compiler-using-crosstool-ng-for-beaglebone aria-label="Cross-compiler using crosstool-ng for Beaglebone">Cross-compiler using crosstool-ng for Beaglebone</a><ul><li><a href=#building-crosstool-ng aria-label="Building crosstool-ng">Building crosstool-ng</a></li><li><a href=#beaglebone-side aria-label="Beaglebone side">Beaglebone side</a></li><li><a href=#patching-binutils aria-label="Patching binutils">Patching binutils</a></li><li><a href=#back-to-host-pc-and-finishing-compilation aria-label="Back to host-pc and finishing compilation">Back to host-pc and finishing compilation</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=cross-compiler-using-crosstool-ng-for-beaglebone>Cross-compiler using crosstool-ng for Beaglebone<a hidden class=anchor aria-hidden=true href=#cross-compiler-using-crosstool-ng-for-beaglebone>#</a></h2><p>In the <a href=https://parzival2.github.io/blog/posts/beaglebone-cross-compile/>previous</a> post, I have used an already available cross-compiling compiler to cross-compile a C++ project for Beaglebone. I want to learn how I can do that so that I can utilize the learned knowledge if the need arises.
I came to know that we can build a compiler using a tool called <code>crosstool-ng</code>. I am going to use it to build a compiler that can be used to cross-compile C and C++ applications for Beaglebone.</p><h3 id=building-crosstool-ng>Building crosstool-ng<a hidden class=anchor aria-hidden=true href=#building-crosstool-ng>#</a></h3><p>The <code>crosstool-ng</code> has to be built as an application before it can be used to build the compiler. When built, it will produce an executable <code>ct-ng</code> that can be used to build the final compiler.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/crosstool-ng/crosstool-ng
cd crosstool-ng
./bootstrap
./configure --enable-local
make
</code></pre></div><p>After running the above commands, you will see that they have produced an executable <code>ct-ng</code>.</p><p>Generate the configuration for <code>ARM cortex A8 processor</code> using <code>ct-ng</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./ct-ng arm-cortex_a8-linux-gnueabi
</code></pre></div><p>Run <code>menuconfig</code> to edit the configurations</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./ct-ng menuconfig
</code></pre></div><p>Make changes in <strong><code>Paths and misc options</code></strong> as shown below</p><a data-flickr-embed=true href=https://www.flickr.com/photos/192459396@N08/51142774648/in/dateposted-public/ title=render-tool-chain-ro><img src=https://live.staticflickr.com/65535/51142774648_0410cbbc17_b.jpg width=996 height=642 alt=render-tool-chain-ro></a><script async src=//embedr.flickr.com/assets/client-code.js></script><p>and also make changes in <strong><code>Target options</code></strong> to enable <code>hard-floating</code> point calculation capability.</p><a data-flickr-embed=true href=https://www.flickr.com/photos/192459396@N08/51141883977/in/dateposted-public/ title=floating-point><img src=https://live.staticflickr.com/65535/51141883977_8d7017cc2c_b.jpg width=997 height=640 alt=floating-point></a><script async src=//embedr.flickr.com/assets/client-code.js></script><p>Exit and build the compiler using</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./ct-ng build
</code></pre></div><p>It will take ~20minutes and if you have followed everything correctly then the build should succeed and you will have a folder in <code>~/x-tools</code> and the compiler will be in <code>~/x-tools/arm-cortex_a8-linux-gnueabihf/bin</code></p><p>As you can see you didn&rsquo;t change any configurations related to the compiler version and the Linux version on Beaglebone. The compiler you generated will not work if it depends on the libraries that are on Beaglebone and you would like to use mount the file-system using <code>sshfs</code> for sysroot as mentioned in the <a href=https://parzival2.github.io/blog/posts/beaglebone-cross-compile/>previous</a> post.</p><h3 id=beaglebone-side>Beaglebone side<a hidden class=anchor aria-hidden=true href=#beaglebone-side>#</a></h3><p>Before we can build the compiler on the host-pc, we need to gather some data on the Beaglebone side.
It is important that the GCC compiler that we are trying to build and the one that we have on the Beaglebone match. The GCC compiler on the Beaglebone can be found by using the command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>debian@beaglebone:~$ gcc -v
Using built-in specs.
COLLECT_GCC<span style=color:#f92672>=</span>gcc
COLLECT_LTO_WRAPPER<span style=color:#f92672>=</span>/usr/lib/gcc/arm-linux-gnueabihf/8/lto-wrapper
Target: arm-linux-gnueabihf
Configured with: ../src/configure -v --with-pkgversion<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Debian 8.3.0-6&#39;</span> --with-bugurl<span style=color:#f92672>=</span>file:///usr/share/doc/gcc-8/README.Bugs --enable-languages<span style=color:#f92672>=</span>c,ada,c++,go,d,fortran,objc,obj-c++ --prefix<span style=color:#f92672>=</span>/usr --with-gcc-major-version-only --program-suffix<span style=color:#f92672>=</span>-8 --program-prefix<span style=color:#f92672>=</span>arm-linux-gnueabihf- --enable-shared --enable-linker-build-id --libexecdir<span style=color:#f92672>=</span>/usr/lib --without-included-gettext --enable-threads<span style=color:#f92672>=</span>posix --libdir<span style=color:#f92672>=</span>/usr/lib --enable-nls --enable-bootstrap --enable-clocale<span style=color:#f92672>=</span>gnu --enable-libstdcxx-debug --enable-libstdcxx-time<span style=color:#f92672>=</span>yes --with-default-libstdcxx-abi<span style=color:#f92672>=</span>new --enable-gnu-unique-object --disable-libitm --disable-libquadmath --disable-libquadmath-support --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc<span style=color:#f92672>=</span>auto --enable-multiarch --disable-sjlj-exceptions --with-arch<span style=color:#f92672>=</span>armv7-a --with-fpu<span style=color:#f92672>=</span>vfpv3-d16 --with-float<span style=color:#f92672>=</span>hard --with-mode<span style=color:#f92672>=</span>thumb --disable-werror --enable-checking<span style=color:#f92672>=</span>release --build<span style=color:#f92672>=</span>arm-linux-gnueabihf --host<span style=color:#f92672>=</span>arm-linux-gnueabihf --target<span style=color:#f92672>=</span>arm-linux-gnueabihf
Thread model: posix
gcc version 8.3.0 <span style=color:#f92672>(</span>Debian 8.3.0-6<span style=color:#f92672>)</span> 
</code></pre></div><p>Mine turned out to be <code>8.3.0</code></p><p>Next we need to find the <code>GLIBC</code> version</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>debian@beaglebone:~$ ldd --version
ldd <span style=color:#f92672>(</span>Debian GLIBC 2.28-10<span style=color:#f92672>)</span> 2.28
</code></pre></div><p>Then <code>binutils</code> version</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>debian@beaglebone:~$ ld --version
GNU ld <span style=color:#f92672>(</span>GNU Binutils <span style=color:#66d9ef>for</span> Debian<span style=color:#f92672>)</span> 2.31.1
Copyright <span style=color:#f92672>(</span>C<span style=color:#f92672>)</span> <span style=color:#ae81ff>2018</span> Free Software Foundation, Inc.
</code></pre></div><p>We also need the current Linux version that our Beaglebone have</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>uname -a
Linux beaglebone 4.19.94-ti-rt-r60 <span style=color:#75715e>#1buster SMP PREEMPT RT Wed Mar 17 16:22:33 UTC 2021 armv7l GNU/Linux</span>
</code></pre></div><p>If you see the command where we determined <code>gcc -v</code> you will notice that <code>--enable-multiarch</code> has been enabled. This makes it to have another folder named <code>arm-linux-gnueabihf</code> in the <code>/usr/include</code> and <code>/usr/lib</code> folders as seen below</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/usr/lib/
├── apt
│   ├── methods
│   ├── planners
│   └── solvers
├── arm-linux-gnueabihf
│   ├── audit
│   ├── coreutils
</code></pre></div><p>The cross-compiler that we are building needs to know that it has to look for some includes and libraries in that folder. This can be solved by applying a patch in <code>binutils</code> while building it using <code>crosstool-ng</code>.</p><p>Install the source for <code>binutils</code> on Beaglebone</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt install binutils-source
</code></pre></div><h3 id=patching-binutils>Patching binutils<a hidden class=anchor aria-hidden=true href=#patching-binutils>#</a></h3><p>Applying a patch for <code>binutils</code> is as simple as copying the patch from Beaglebone over to the host-pc.</p><p>As you have already installed the <code>binutils-source</code> the patches are also installed. The source can be found in <code>/usr/src/binutils</code> on Beaglebone. In patches folder, copy and paste the <code>129_multiarch_libpath.patch</code> in <code>/crosstool-ng/packages/binutils/2.31.1/</code>. Please replace the <code>2.31.1</code> with the version that you determined by running <code>ld --version</code> in one of the previous step.</p><h3 id=back-to-host-pc-and-finishing-compilation>Back to host-pc and finishing compilation<a hidden class=anchor aria-hidden=true href=#back-to-host-pc-and-finishing-compilation>#</a></h3><p>Now we are back to the host-pc for finishing up the compilation. We need to configure all the versions of the tools according to the versions that we determined in Beaglebone so as to avoid linker errors.</p><p>Run <code>./ct-ng menuconfig</code> to bring up the configuration window.</p><p>In <strong><code>Operating System</code></strong> change the version of Linux that closely corresponds to the Linux version of Beaglebone. I am going with <code>4.18.20</code></p><a data-flickr-embed=true href=https://www.flickr.com/photos/192459396@N08/51143369214/in/dateposted-public/ title=linux-version><img src=https://live.staticflickr.com/65535/51143369214_3cd5c4133a_b.jpg width=989 height=636 alt=linux-version></a><script async src=//embedr.flickr.com/assets/client-code.js></script><p>Next in <strong><code>Binary utilities</code></strong> section, change the version of binutils that is going to be used for the build. This has to correspond with the version that was determined earlier in Beaglebone.</p><a data-flickr-embed=true href=https://www.flickr.com/photos/192459396@N08/51141920702/in/dateposted-public/ title=binutils-version><img src=https://live.staticflickr.com/65535/51141920702_f15a537876_b.jpg width=982 height=633 alt=binutils-version></a><script async src=//embedr.flickr.com/assets/client-code.js></script><p>Moving on to <strong><code>C-library</code></strong>, change the glibc version to match with the version from Beaglebone.</p><a data-flickr-embed=true href=https://www.flickr.com/photos/192459396@N08/51142816513/in/dateposted-public/ title=glibc-version><img src=https://live.staticflickr.com/65535/51142816513_3cf0d34860_b.jpg width=991 height=640 alt=glibc-version></a><script async src=//embedr.flickr.com/assets/client-code.js></script><p>Now in <strong><code>C compiler</code></strong>, change the version of <code>gcc</code> to closely correspond to the version that is found in Beaglebone and also in <code>gcc extra config</code> add <code>--enable-multiarch</code> option as shown below.</p><a data-flickr-embed=true href=https://www.flickr.com/photos/192459396@N08/51142822523/in/dateposted-public/ title=c-compiler-version><img src=https://live.staticflickr.com/65535/51142822523_eb0ae30cd4_b.jpg width=989 height=642 alt=c-compiler-version></a><script async src=//embedr.flickr.com/assets/client-code.js></script><p>Run</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>export DEB_TARGET_MULTIARCH<span style=color:#f92672>=</span>arm-linux-gnueabihf
</code></pre></div><p>Now build the toolchain again using <code>./ct-ng build</code>.</p><p>If you run</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./arm-cortex_a8-linux-gnueabihf-ld -verbose | grep -i <span style=color:#e6db74>&#34;SEARCH&#34;</span>
</code></pre></div><p>from the compiler installation folder in <code>~/x-tools</code> you will see that it also searches for <code>arm-linux-gnueabihf</code> folder.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/usr/local/lib/arm-linux-gnueabihf&#34;</span><span style=color:#f92672>)</span>; SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/lib/arm-linux-gnueabihf&#34;</span><span style=color:#f92672>)</span>; SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/usr/lib/arm-linux-gnueabihf&#34;</span><span style=color:#f92672>)</span>; SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/usr/local/lib&#34;</span><span style=color:#f92672>)</span>; SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/lib&#34;</span><span style=color:#f92672>)</span>; SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/usr/lib&#34;</span><span style=color:#f92672>)</span>; SEARCH_DIR<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;=/home/kalyan/x-tools/arm-cortex_a8-linux-gnueabihf/arm-cortex_a8-linux-gnueabihf/lib&#34;</span><span style=color:#f92672>)</span>;
</code></pre></div><p>You can use the generated compiler using this toolchain file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=color:#75715e># Set the system name
</span><span style=color:#75715e></span>set(<span style=color:#e6db74>CMAKE_SYSTEM_NAME</span> <span style=color:#e6db74>Linux</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># C Compiler
</span><span style=color:#75715e></span>set(<span style=color:#e6db74>COMPILER_PATH</span> <span style=color:#e6db74>/home/kalyan/x-tools/arm-cortex_a8-linux-gnueabihf/bin</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>COMPILER_FRONT</span> <span style=color:#e6db74>arm-cortex_a8-linux-gnueabihf-</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>CMAKE_TRY_COMPILE_TARGET_TYPE</span> <span style=color:#e6db74>STATIC_LIBRARY</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>CMAKE_C_COMPILER</span> <span style=color:#f92672>${</span>COMPILER_PATH<span style=color:#f92672>}</span><span style=color:#e6db74>/</span><span style=color:#f92672>${</span>COMPILER_FRONT<span style=color:#f92672>}</span><span style=color:#e6db74>gcc</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>CMAKE_CXX_COMPILER</span> <span style=color:#f92672>${</span>COMPILER_PATH<span style=color:#f92672>}</span><span style=color:#e6db74>/</span><span style=color:#f92672>${</span>COMPILER_FRONT<span style=color:#f92672>}</span><span style=color:#e6db74>g++</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Sysroot location
</span><span style=color:#75715e># It is mounted using sshfs
</span><span style=color:#75715e></span>set(<span style=color:#e6db74>CMAKE_SYSROOT</span> <span style=color:#e6db74>/home/kalyan/Beaglebone-Sysroot</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># These lines are necessary to let cmake know to only look in the
</span><span style=color:#75715e># beaglebone for the libraries instead of looking in host pc.
</span><span style=color:#75715e># sshfs debian@192.168.7.2:/ /home/kalyan/Beaglegone-Sysroot/ -o transform_symlinks
</span><span style=color:#75715e></span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_PROGRAM</span> <span style=color:#e6db74>NEVER</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_LIBRARY</span> <span style=color:#e6db74>ONLY</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_PACKAGE</span> <span style=color:#e6db74>ONLY</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>set(<span style=color:#e6db74>CMAKE_FIND_ROOT_PATH_MODE_INCLUDE</span> <span style=color:#e6db74>ONLY</span>)<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://parzival2.github.io/blog/tags/beaglebone/>beaglebone</a></li><li><a href=https://parzival2.github.io/blog/tags/crosstool-ng/>crosstool-ng</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Cross-compiler using crosstool-ng for Beaglebone on twitter" href="https://twitter.com/intent/tweet/?text=Cross-compiler%20using%20crosstool-ng%20for%20Beaglebone&url=https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f&hashtags=beaglebone%2ccrosstool-ng"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Cross-compiler using crosstool-ng for Beaglebone on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f&title=Cross-compiler%20using%20crosstool-ng%20for%20Beaglebone&summary=Cross-compiler%20using%20crosstool-ng%20for%20Beaglebone&source=https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Cross-compiler using crosstool-ng for Beaglebone on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f&title=Cross-compiler%20using%20crosstool-ng%20for%20Beaglebone"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Cross-compiler using crosstool-ng for Beaglebone on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Cross-compiler using crosstool-ng for Beaglebone on whatsapp" href="https://api.whatsapp.com/send?text=Cross-compiler%20using%20crosstool-ng%20for%20Beaglebone%20-%20https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Cross-compiler using crosstool-ng for Beaglebone on telegram" href="https://telegram.me/share/url?text=Cross-compiler%20using%20crosstool-ng%20for%20Beaglebone&url=https%3a%2f%2fparzival2.github.io%2fblog%2fposts%2fcrosstool-ng-beaglebone%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://parzival2.github.io/blog>blog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/blog/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>